<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Traversal &mdash; Python Notes 0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/css/customizations.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Python Notes 0 documentation" href="../../../../index.html" />
    <link rel="up" title="Traversal vs. URL Dispatch" href="../pyramid_traversal_vs_dispatch.html" />
    <link rel="next" title="Hybrid Traversal" href="../hybrid_app/hybrid_traversal.html" />
    <link rel="prev" title="URL Dispatch" href="../dispatch_app/url_dispatch.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="traversal">
<h1>Traversal<a class="headerlink" href="#traversal" title="Permalink to this headline">¶</a></h1>
<p>Traversal is a routing system that is built around a model called the <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/glossary.html#term-resource-tree">resource tree</a>.</p>
<p>URLs are matched to views based off of the path segments provided in the request, which are used to navigate the resource tree until a <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/glossary.html#term-context">context</a> <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/glossary.html#term-resource">resource</a> is found. That resource (now known as context), along with any left over path segments, is used to lookup a view callable, which then serves the response.</p>
<p>With Traversal, it&#8217;s <strong>required</strong> that the <code class="docutils literal"><span class="pre">Configurator</span></code> is supplied a &#8220;Root Factory&#8221; which is the very first item in the resource tree that all items derive their lineage from.</p>
<p>Since the model/resource tree is so integral to a Traversal application&#8217;s structure, it&#8217;s easiest to start by defining what a resource is.</p>
<div class="section" id="the-resource-tree">
<h2>The Resource Tree<a class="headerlink" href="#the-resource-tree" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/traversal.html#the-resource-tree">The Resource Tree</a> is the backbone of a Traversal application. While URL Dispatch applications are dependent on the <em>routes</em> defined in the application, Traversal Applications are defined by the <em>resource tree</em>, and are dependent on it&#8217;s structure.</p>
<p>The Resource Tree is a heirarchy of <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/resources.html">resources</a> that begin at a single RootFactory established by the <code class="docutils literal"><span class="pre">Configurator</span></code>.</p>
<p>Resources are defined by their <code class="docutils literal"><span class="pre">__name__</span></code> attribute, which is responsible for their location &amp; discovery, and their <code class="docutils literal"><span class="pre">__parent__</span></code> attribute which is the parent object responsible for serving them based on their <code class="docutils literal"><span class="pre">__name__</span></code>.</p>
<p>Resources are considered <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/resources.html#location-aware">location-aware</a> if they have both their <code class="docutils literal"><span class="pre">__name__</span></code> and <code class="docutils literal"><span class="pre">__parent__</span></code> attributes defined (and the heirarchy of parents are also location aware).</p>
<p>When using Traversal, <strong>all resources must be location aware</strong>, meaning <em>every</em> resource must have it&#8217;s <code class="docutils literal"><span class="pre">__name__</span></code> and <code class="docutils literal"><span class="pre">__parent__</span></code> defined.</p>
<div class="section" id="id1">
<h3>Resource<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Any object with <code class="docutils literal"><span class="pre">__parent__</span></code> and <code class="docutils literal"><span class="pre">__name__</span></code> attributes.</p>
<p><code class="docutils literal"><span class="pre">__parent__</span></code></p>
<blockquote>
<div><p>The object that is the parent resource of <em>this</em> resource.</p>
<p>Is <code class="docutils literal"><span class="pre">None</span></code> for the root factory.</p>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">__name__</span></code></p>
<blockquote>
<div><p>The key/id of <em>this</em> resource.</p>
<p>Resource objects of the same class w/ equal <code class="docutils literal"><span class="pre">__name__</span></code> <strong>must always</strong> be equal.</p>
<p>Is <code class="docutils literal"><span class="pre">None</span></code> for the root factory.</p>
</div></blockquote>
</div></blockquote>
<p>That&#8217;s all that&#8217;s required to define a Resource!</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># a resource w/ minimum requirements</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">parent</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">name</span>
</span></pre></div>
</div>
<p>Now that a standard <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/glossary.html#term-resource">resource</a> is defined, there are two sub-types of resources with important distinctions:</p>
</div>
<div class="section" id="container-resource">
<h3>Container Resource<a class="headerlink" href="#container-resource" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A dict-like resource (has <code class="docutils literal"><span class="pre">__getitem__(self,</span> <span class="pre">key)</span></code> defined) that, when supplied a key, will return the next resource in the resource tree identified by that key.</p>
<p><code class="docutils literal"><span class="pre">__getitem__(self,</span> <span class="pre">key)</span></code></p>
<blockquote>
<div><p>Returns the next resource in the resource tree where <code class="docutils literal"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">key</span></code> and <code class="docutils literal"><span class="pre">__parent__</span> <span class="pre">is</span> <span class="pre">self</span></code> (<code class="docutils literal"><span class="pre">self</span></code> being the object called w/ <code class="docutils literal"><span class="pre">__getitem__</span></code>)</p>
<p>If no resource with <code class="docutils literal"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">key</span></code> can be found, <code class="docutils literal"><span class="pre">KeyError</span></code> should be raised.</p>
</div></blockquote>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContainerResource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">name</span>

<span class="hll">    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Resource</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Note that container resources can return other container resources, or can also raise key errors if that child with the supplied <code class="docutils literal"><span class="pre">__name__</span></code> can&#8217;t be found.</p>
</div>
<div class="section" id="leaf-resource">
<h3>Leaf Resource<a class="headerlink" href="#leaf-resource" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A resource that <em>does not</em> have <code class="docutils literal"><span class="pre">__getitem__(self,</span> <span class="pre">key)</span></code> defined, or is defined such that <code class="docutils literal"><span class="pre">KeyError</span></code> is always raised.</p>
<p>Represents the end of the resource tree (hence the name <em>leaf</em>).</p>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LeafResource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name__</span> <span class="o">=</span> <span class="n">name</span>

<span class="hll">    <span class="c1"># def __getitem__(self, key):</span>
</span><span class="hll">    <span class="c1">#     raise KeyError()</span>
</span></pre></div>
</div>
</div>
<div class="section" id="root-factory">
<h3>Root Factory<a class="headerlink" href="#root-factory" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The very first resource in the resource tree, that has <code class="docutils literal"><span class="pre">__name__</span> <span class="pre">=</span> <span class="pre">None</span>&nbsp; <span class="pre">#</span> <span class="pre">or</span> <span class="pre">&quot;&quot;</span></code> and <code class="docutils literal"><span class="pre">__parent__</span> <span class="pre">=</span> <span class="pre">None</span></code>.</p>
<p>Is initialized by a request object <code class="docutils literal"><span class="pre">__init__(self,</span> <span class="pre">request)</span></code> and acts as a container resource to the next level of the resource tree.</p>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RootFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="hll">    <span class="n">__name__</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># or &quot;&quot;</span>
</span><span class="hll">    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ContainerResource</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The RootFactory is initialized w/ a <code class="docutils literal"><span class="pre">Request</span></code> object, which seems significant.</p>
<p>However, it&#8217;s not required or suggested anywhere in pyramid docs to pass the request object through the resource tree.</p>
<p class="last">How does a 1st level resource reference the RootFactory (e.g. by creating one) if it doesn&#8217;t have access to the request object?</p>
</div>
</div>
<div class="section" id="sqlalchemy-resource-example">
<h3>sqlalchemy Resource Example<a class="headerlink" href="#sqlalchemy-resource-example" title="Permalink to this headline">¶</a></h3>
<p>Here&#8217;s a quick example of what a resource tree might look like in sqlalchemy</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RootFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__name__</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Resource</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span>

<span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__parent__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">RootFactory</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;resource&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="traversing-the-resource-tree-aka-resource-location">
<h2>Traversing The Resource Tree aka Resource Location<a class="headerlink" href="#traversing-the-resource-tree-aka-resource-location" title="Permalink to this headline">¶</a></h2>
<p>Traversal uses the resource tree to find a resource to serve as <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/glossary.html#term-context">context</a> for a request based on PATH_INFO (the tuple of path keys from the URL).</p>
<p><strong>resource location</strong> is the act of traversing the resource tree.</p>
<p>Resource location operates using the <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/traversal.html#the-traversal-algorithm">traversal algorithm</a> which leverages the structure of the resource tree against the path to locate resources.</p>
<div class="section" id="the-traversal-algorithm">
<h3>The Traversal Algorithm<a class="headerlink" href="#the-traversal-algorithm" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Initialize the RootFactory with the request object.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="n">RootFactory</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># __init__ if object or __call__ if fxn/already initialized</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Use the 1st path segment as an argument to <code class="docutils literal"><span class="pre">context.__getitem__(key)</span></code></li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># path: /foo</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">]</span>  <span class="c1"># RootFactory(request)[&#39;foo&#39;]</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>This is repeated with each new resource &amp; path segment until...<ul>
<li>the path segments have been exhausted</li>
<li>a leaf-resource is reached (does not have <code class="docutils literal"><span class="pre">__getitem__</span></code> defined)</li>
<li>a <code class="docutils literal"><span class="pre">KeyError</span></code> is raised.</li>
</ul>
</li>
</ol>
<p>The resulting object is then used as <code class="docutils literal"><span class="pre">request.context</span></code> and, if the view accepts it, the <code class="docutils literal"><span class="pre">context</span></code> *arg for a matching view callable.</p>
<p>When played out fully, the traversal algorithm looks a lot like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># path: /foo/bar/baz/qux</span>

<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">RootFactory</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;foo&#39;</span><span class="p">][</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">][</span><span class="s1">&#39;qux&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If this is unchained, it looks a lot like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># path: /foo/bar/baz/qux</span>

<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">RootFactory</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>  <span class="c1"># RootFactory[&#39;foo&#39;]</span>
<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># Foo[&#39;bar&#39;]</span>
<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>  <span class="c1"># Bar[&#39;baz&#39;]</span>
<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;qux&#39;</span><span class="p">]</span>  <span class="c1"># Baz[&#39;qux&#39;]</span>
</pre></div>
</div>
<p>There&#8217;s actually much more going on (like checking for <code class="docutils literal"><span class="pre">__getitem__</span></code> &amp; handling <code class="docutils literal"><span class="pre">KeyError</span></code>), but this demonstration highlights how resource location operates.</p>
</div>
</div>
<div class="section" id="view-callables-in-traversal">
<h2>View Callables in Traversal<a class="headerlink" href="#view-callables-in-traversal" title="Permalink to this headline">¶</a></h2>
<p>To match requests to view callables, Traversal performs a <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/muchadoabouttraversal.html#view-lookup">view lookup</a>.</p>
<p>After resource location, Traversal tries to match a view based on the <code class="docutils literal"><span class="pre">request.context</span></code> and the <code class="docutils literal"><span class="pre">view_name</span></code>.</p>
<p>View name is determined as <em>the first path segment that is not used in resource location</em>.</p>
<p>The view lookup algorithm acts like this...</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># path: /foo/bar/profile</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="s1">&#39;foo&#39;</span><span class="p">][</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>  <span class="c1"># Bar[&#39;profile&#39;] =&gt; KeyError</span>
<span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
<span class="n">view_callable</span> <span class="o">=</span> <span class="n">get_view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s2">&quot;profile&quot;</span><span class="p">)</span>  <span class="c1"># the 1st unused PATH_INFO</span>
<span class="n">view_callable</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># or view_callable(context, request)</span>
</pre></div>
</div>
<p>...with a few exceptions:</p>
<ul class="simple">
<li>If there&#8217;s no view match for the context object a view with the same name but no context will be matched.</li>
<li>If no view name is available from the path (no KeyError is raised &amp; all of PATH_INFO was used) then an unnamed view with the same context will be matched.</li>
<li>If neither of the above match, an unnamed view with no context will be matched.</li>
<li>If no views match, an <code class="docutils literal"><span class="pre">HTTPNotFound</span></code> will be raised.</li>
</ul>
<p>Below are some example paths that show what the view_name and resource are after resource location and view lookup.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># resource tree: RootFactory =&gt; Foo =&gt; Bar</span>

<span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">baz</span>   <span class="o">=&gt;</span> <span class="n">view_name</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span>   <span class="n">context</span><span class="p">:</span> <span class="n">Bar</span><span class="p">,</span>
<span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">hello</span> <span class="o">=&gt;</span> <span class="n">view_name</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Bar</span><span class="p">,</span>
<span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span>       <span class="o">=&gt;</span> <span class="n">view_name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>      <span class="n">context</span><span class="p">:</span> <span class="n">Bar</span><span class="p">,</span>
<span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">hello</span>     <span class="o">=&gt;</span> <span class="n">view_name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>      <span class="n">context</span><span class="p">:</span> <span class="n">Bar</span><span class="p">(</span><span class="n">__name__</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span>
<span class="o">/</span><span class="n">hello</span>         <span class="o">=&gt;</span> <span class="n">view_name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>      <span class="n">context</span><span class="p">:</span> <span class="n">Foo</span><span class="p">(</span><span class="n">__name__</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>Defining views in traversal is easy: because view lookup is performed based on a view&#8217;s <code class="docutils literal"><span class="pre">&#64;view_config</span></code> there&#8217;s no need to include them in the <code class="docutils literal"><span class="pre">Configurator</span></code> (if not using <code class="docutils literal"><span class="pre">&#64;view_config</span></code>, add them with <code class="docutils literal"><span class="pre">Configurator.add_view()</span></code>.</p>
<p>A Traversal view only needs the necessary information needed to find it during view lookup. This means that it <em>should</em> supply <code class="docutils literal"><span class="pre">context=ResourceClass</span></code> to match the <code class="docutils literal"><span class="pre">request.context</span></code> to, or <code class="docutils literal"><span class="pre">name=&quot;view_name&quot;</span></code> to match the view_name to.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># traversal_app/views.py</span>
<span class="nd">@view_config</span><span class="p">()</span>  <span class="c1"># no name, no context; matches all unmatched in view lookup</span>
<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># def default(context, request)</span>
    <span class="k">raise</span> <span class="n">HTTPNotFound</span><span class="p">()</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">RootFactory</span><span class="p">)</span>  <span class="c1"># RootFactory context, no name. matches &#39;/&#39; path</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># def index(context, request)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">Resource</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># def hello(context, request)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="c1"># traversal_app/app_config.py</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_root_factory</span><span class="p">(</span><span class="n">RootFactory</span><span class="p">)</span>
    <span class="c1"># config.add_view(&quot;traversal_app.views.hello&quot;, name=&quot;hello&quot;, context=Resource)</span>
    <span class="o">...</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-urls-paths-in-traversal">
<h2>Generating URLs &amp; Paths in Traversal<a class="headerlink" href="#generating-urls-paths-in-traversal" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/resources.html#generating-the-url-of-a-resource">Generating the URLs and paths of resources</a> is dependent on their <code class="docutils literal"><span class="pre">__name__</span></code> and where they exist in the heirarchy of the resource tree.</p>
<p>Resource URLs &amp; paths are generated using the resource object using <code class="docutils literal"><span class="pre">request.resource_url()</span></code> and <code class="docutils literal"><span class="pre">request.resource_path()</span></code> respectively.</p>
<p>Since Traversal does not use any routes to match view callables, a view_name (if desired) must be passed as an extra *arg.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">RootFactory</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">/</span>

<span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">Bar</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span>

<span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">hello</span>

<span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">world</span>
</pre></div>
</div>
</div>
<div class="section" id="containment-interfaces">
<h2>Containment &amp; Interfaces<a class="headerlink" href="#containment-interfaces" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While I haven&#8217;t experimented with it yet, it seems like the <code class="docutils literal"><span class="pre">containment</span></code> view configuration <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/viewconfig.html#predicate-arguments">predicate argument</a> and <a class="reference external" href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/resources.html#resources-which-implement-interfaces">interfaces</a> for resource objects could be a nice addition to Traversal Mastery</p>
</div>
</div>
<div class="section" id="troubleshooting-traversal-best-practices">
<h2>Troubleshooting Traversal &amp; Best Practices<a class="headerlink" href="#troubleshooting-traversal-best-practices" title="Permalink to this headline">¶</a></h2>
<p>Here are some solutions to problems!</p>
<div class="section" id="avoiding-view-name-resource-name-collisions">
<h3>Avoiding view_name &amp; Resource.__name__ collisions<a class="headerlink" href="#avoiding-view-name-resource-name-collisions" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I&#8217;ve answered <a class="reference external" href="http://stackoverflow.com/questions/37218572/pyramid-traversal-name-matching-a-view-name">my stack overflow post</a> about this issue, but there&#8217;s still room for discussion on other solutions.</p>
</div>
<p>To avoid collisions of view_names and resource __name__s, it&#8217;s a good idea to use a &#8220;dummy&#8221; container to separate container resources.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RootFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__name__</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

<span class="hll">    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;resource&quot;</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">ResourceFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">KeyError</span>
</span>
<span class="k">class</span> <span class="nc">ResourceFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="hll">    <span class="n">__name__</span> <span class="o">=</span> <span class="s2">&quot;resource&quot;</span>
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">parent</span>

<span class="hll">    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span class="hll">        <span class="k">try</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Resource</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</span><span class="hll">        <span class="k">except</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">KeyError</span>
</span>
<span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__parent__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="k">return</span> <span class="n">ResourceFactory</span><span class="p">(</span><span class="n">RootFactory</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;resource&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Using <code class="docutils literal"><span class="pre">ResourceFactory</span></code> and having <code class="docutils literal"><span class="pre">RootFactory</span></code> act as it&#8217;s parent, now resource paths like <code class="docutils literal"><span class="pre">/resource/foo</span></code> can be generated instead of <code class="docutils literal"><span class="pre">/foo</span></code>.</p>
</div>
<div class="section" id="debugging-traversal-view-lookup">
<h3>Debugging Traversal View Lookup<a class="headerlink" href="#debugging-traversal-view-lookup" title="Permalink to this headline">¶</a></h3>
<p>To include extra information about context and view names in 404 Not Found responses, add the following to the <code class="docutils literal"><span class="pre">.ini</span></code> used to initialize the application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">pyramid</span><span class="o">.</span><span class="n">debug_notfound</span> <span class="o">=</span> <span class="n">true</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Traversal</a><ul>
<li><a class="reference internal" href="#the-resource-tree">The Resource Tree</a><ul>
<li><a class="reference internal" href="#id1">Resource</a></li>
<li><a class="reference internal" href="#container-resource">Container Resource</a></li>
<li><a class="reference internal" href="#leaf-resource">Leaf Resource</a></li>
<li><a class="reference internal" href="#root-factory">Root Factory</a></li>
<li><a class="reference internal" href="#sqlalchemy-resource-example">sqlalchemy Resource Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#traversing-the-resource-tree-aka-resource-location">Traversing The Resource Tree aka Resource Location</a><ul>
<li><a class="reference internal" href="#the-traversal-algorithm">The Traversal Algorithm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#view-callables-in-traversal">View Callables in Traversal</a></li>
<li><a class="reference internal" href="#generating-urls-paths-in-traversal">Generating URLs &amp; Paths in Traversal</a></li>
<li><a class="reference internal" href="#containment-interfaces">Containment &amp; Interfaces</a></li>
<li><a class="reference internal" href="#troubleshooting-traversal-best-practices">Troubleshooting Traversal &amp; Best Practices</a><ul>
<li><a class="reference internal" href="#avoiding-view-name-resource-name-collisions">Avoiding view_name &amp; Resource.__name__ collisions</a></li>
<li><a class="reference internal" href="#debugging-traversal-view-lookup">Debugging Traversal View Lookup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../pyramid.html">pyramid</a><ul>
  <li><a href="../pyramid_traversal_vs_dispatch.html">Traversal vs. URL Dispatch</a><ul>
      <li>Previous: <a href="../dispatch_app/url_dispatch.html" title="previous chapter">URL Dispatch</a></li>
      <li>Next: <a href="../hybrid_app/hybrid_traversal.html" title="next chapter">Hybrid Traversal</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/python_libraries/pyramid/pyramid_traversal_vs_dispatch/traversal_app/traversal.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Maxwell G. Brown.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../../../_sources/python_libraries/pyramid/pyramid_traversal_vs_dispatch/traversal_app/traversal.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>